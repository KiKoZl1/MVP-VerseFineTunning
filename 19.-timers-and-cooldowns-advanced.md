---
id: 19
title: 19. Timers & Cooldowns in Verse — Advanced Patterns
tags: [verse, timers, cooldowns, concurrency, scheduling]
summary: Robust timing utilities built from simple Sleep/loop patterns: one-shot timers, repeating timers, cooldown gates, and cancellation.
---

# Timers & Cooldowns — Advanced Patterns

Timers and cooldowns can be composed from small, readable blocks. This page provides **reusable helpers** and shows how to **cancel** or **gate** actions safely.

---

## 1) One-Shot Timer

```verse
SetTimeout(DelaySeconds : float, Action : void -> void) : void =
    Sleep(DelaySeconds)
    Action()
```

- Simple wrapper for delayed effects. Keep actions **small and pure** where possible.

---

## 2) Repeating Timer (Bounded)

```verse
SetInterval(IntervalSeconds : float, Ticks : int, Action : void -> void) : void =
    i : int = 0
    loop:
        if (i >= Ticks):
            return
        Action()
        Sleep(IntervalSeconds)
        set i = i + 1
```

- Bounded by `Ticks` to avoid runaway loops.

---

## 3) Cooldown Gate (Reusable)

```verse
MakeCooldown(Seconds : float) : void -> logic -> void =
    CanFire? : logic = true

    return (Action : logic -> void) : void =
        if (CanFire?):
            set CanFire? = false
            Action(true)
            Sleep(Seconds)
            set CanFire? = true
        else:
            Action(false)
```

Usage:
```verse
UseAbility := MakeCooldown(5.0)

UseAbility((Fired : logic) : void =
    if (Fired):
        HurtFirstPlayer(20.0)
    else:
        Print("On cooldown")
)
```

- Encapsulates state and timing; returns **true/false** to the caller for observability.

---

## 4) Cancellable Interval (Token Pattern)

```verse
type CancelToken = class:
    Cancelled? : logic

NewCancelToken() : CancelToken =
    return CancelToken{Cancelled? := false}

Cancel(T : CancelToken) : void =
    set T.Cancelled? = true

SetIntervalCancellable(IntervalSeconds : float, Action : void -> void, T : CancelToken) : void =
    loop:
        if (T.Cancelled?):
            return
        Action()
        Sleep(IntervalSeconds)
```

Usage:
```verse
T := NewCancelToken()
SetIntervalCancellable(1.0, () : void = Print("tick"), T)
Sleep(3.0)
Cancel(T)
```

- The token is a simple, readable stop flag for long-running loops.

---

## 5) Finetuning Notes (LLM)

- Prefer helpers that keep **state local** and names descriptive.
- Always include **observability** (prints, boolean flags).
- Show a **success** flow and a **blocked/on-cooldown** flow side by side.
